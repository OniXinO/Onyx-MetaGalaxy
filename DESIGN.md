# Onyx MetaGalaxy (OMG) — Design Doc

## Мета і Бачення
- Зробити OMG універсальною надбудовою для Kerbal Space Program, що керує комбінаціями планет-паків через профілі, маркери та фільтрацію конфігів.
- Забезпечити Plug & Play досвід: обираєш профіль — отримуєш узгоджений набір контенту без конфліктів.
- Поступове розширення: від бази (Stock + OPM) до популярних комбінацій (GU/BH/KSRSS/GPP тощо).

## Обсяг першого тестового релізу 0.0.1
- База: Stock + OPM (Outer Planets Mod) через OMG-обгортку.
- Документація: README, DESIGN Doc, CHANGELOG, OMG.version оновлено на 0.0.1.
- Профілі: додано чотири рівні продуктивності для OPM-only — Productivity, Balance, Quality, Ultra.
- Інфраструктура: авто-очищення легасі-маркерів, фільтрація ConfigNode для відключених паків, безпечний режим логування.

## Ключові Принципи
- Централізовані профілі (`GameData/OniXinO/OMG/Profiles/*.cfg`) описують, які паки увімкнені.
- Маркери `OMG_Enable_<PackId>` у `GameData/OniXinO/` слугують простими умовами для `:NEEDS[]` у ModuleManager патчах.
- Плагін підписується на `OnGameDatabaseLoaded` і фільтрує `ConfigNode` для неактивних паків (safe mode для попереднього огляду логів).
- Налаштування (`OMGSettings.cfg`): `activeProfile`, `strictMarkers`, `filterDisabledPacks`, `filterSafeMode`.

## Архітектура
- Профіль-менеджер (C#):
  - Читання `OMGSettings.cfg` і активного профілю.
  - Збір списку активних паків із профілю.
  - Під час `OnGameDatabaseLoaded`: або логувати (safe mode), або вилучати `ConfigNode` неактивних паків.
- Скрипт активації профілю (PowerShell):
  - Парсинг профілю, створення маркерів у `GameData/OniXinO/`.
  - Авто-очищення легасі-маркерів у корені `GameData`.
  - `strictMarkers`: якщо пак не знайдено — маркер не створюється, видається попередження.
- Патчі сумісності (майбутні):
  - Окремі файли з умовами `:NEEDS[Pack,OMG_Enable_Pack] :AFTER[...]` для мостів між паками і графічними/ґеймплейними модами.

## Профілі Продуктивності
- Рівні: Productivity (Low), Balance (Medium), Quality (High), Ultra (Max).
- На етапі 0.0.1 реалізовано для OPM-only: Productivity, Balance, Quality, Ultra.
- Дизайн-підхід:
  - Профіль визначає набір паків.
  - Рекомендації щодо графічних модів/налаштувань надано в README (плагін не змінює графіку напряму у цьому релізі).
  - Надалі: додати параметр `performanceLevel` у `OMGSettings.cfg` і модульні патчі для графіки/ефектів.

## Налаштування
- `OMGSettings.cfg` ключі:
  - `activeProfile`: імʼя профілю з `Profiles/`.
  - `strictMarkers`: суворий режим створення маркерів тільки для реально наявних паків.
  - `filterDisabledPacks`: ввімкнути фільтрацію `ConfigNode` для відключених паків.
  - `filterSafeMode`: безпечний режим — лише логувати кандидати на фільтрацію.

## Ліцензування (рекомендації)
- Код: MIT — популярна, проста, сумісна з CKAN/SpaceDock.
- Конфіги/ресурси (за потреби): CC BY-NC-SA 4.0 — стандартно для KSP-модів, якщо присутні арт-елементи; або теж MIT, якщо немає обмежень.
- Сумісність: дотримуватися ліцензій сторонніх паків; не включати їхні бінарники/ресурси.

## Канали Дистрибуції
- 0.0.1: GitHub Releases.
- З 0.1: підготовка до SpaceDock і CKAN (метадані, ліцензія, автоматизовані ZIP-артефакти).

## Реліз-процес
- Версіонування: `MAJOR.MINOR.PATCH.BUILD` у `OMG.version`.
  - BUILD — дрібні додатки/гарячі виправлення.
  - PATCH — значимі функціональні доповнення без лому сумісності.
  - MINOR — нові можливості/комбінації профілів, стабільні API.
  - MAJOR — суттєві зміни архітектури/сумісності.
- CHANGELOG: фіксація кожної зміни.
- README: оновлення налаштувань, профілів, інструкцій.

## Roadmap (узагальнено)
- Розширити профілі на інші комбінації паків (GU/BH/KSRSS/GPP) із рівнями якості.
- Каталог мостів сумісності: OPM ↔ GU/BH/KSRSS/GPP; інтеграції зі `scatterer`/`EVE`/`Parallax`, рескейл (KSRSS/SigmaDimensions), геймплей (Kerbalism, ResearchBodies).
- Параметр `performanceLevel` у налаштуваннях + модульні графічні патчі.
- API для розширень (гайд і приклади) для сторонніх авторів.
- Окремі етапи для дерева досліджень/біомів/частин.

## Ризики і Мітігація
- Конфлікти патчів: строгі `:NEEDS/:AFTER`, логування, safe mode.
- Відсутні паки: `strictMarkers`, безпечне створення маркерів.
- Продуктивність: починати з Productivity/Balance, рекомендовані налаштування в README.

## Додатки
- Посилання: GitHub (URL, Releases) у `OMG.version`.
- Логи: формат повідомлень у Plugins README.